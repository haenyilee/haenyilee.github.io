# AOP (3)트랜젝션, Session, Cookie, 커맨드 객체 검증

## 기초셋팅
1. 자바 버전 변경
2. pom.xml 설정
3. web.xml 설정
4. WEB-INF폴더 내에 config 폴더 생성해서 application-context.xml 파일 생성하기
- aop
- beans
- context
- mvc
- p
- tx
5. com.sist.dao 패키지 내에 BoradVO, BoardDAO , BoradMapper 파일 생성



## DB테이블 제작

```tip
- 트랜잭션 기반 AOP가 대부분임
```

- 답변형 게시판 테이블

```sql
CREATE TABLE spring_reply(
    no NUMBER PRIMARY KEY,
    name VARCHAR2(34) NOT NULL,
    subject VARCHAR2(1000) NOT NULL,
    content CLOB NOT NULL,
    pwd VARCHAR2(10) NOT NULL,
    regdate DATE DEFAULT SYSDATE,
    hit NUMBER DEFAULT 0,
    gi NUMBER,
    gs NUMBER DEFAULT 0,
    gt NUMBER DEFAULT 0,
    root NUMBER DEFAULT 0,
    dept NUMBER DEFAULT 0
);
```

## 답변형 게시판 만들기

### BoardVO.java

```
이름      널?       유형             
------- -------- -------------- 
NO      NOT NULL NUMBER         
NAME    NOT NULL VARCHAR2(34)   
SUBJECT NOT NULL VARCHAR2(1000) 
CONTENT NOT NULL CLOB           
PWD     NOT NULL VARCHAR2(10)   
REGDATE          DATE           
HIT              NUMBER         
GI               NUMBER         
GS               NUMBER         
GT               NUMBER         
ROOT             NUMBER         
DEPT             NUMBER  
```

### BoardMapper.java


### BoardDAO.java
- boardListData
- boardInsert



## 로그인 만들기


### 테이블 제작
- board_count

```
CREATE TABLE board_count(
    name VARCHAR2(34) NOT NULL,
    hit NUMBER 
);
```

- board_trigger

```
CREATE OR REPLACE TRIGGER board_trigger
AFTER INSERT ON spring_board
FOR EACH ROW
DECLARE
    v_cnt NUMBER;
BEGIN
    SELECT COUNT(*) INTO v_cnt
    FROM board_count
    WHERE name=:NEW.name;
    
    IF(v_cnt=0) THEN
        INSERT INTO board_count VALUES(:NEW.name,1);
        COMMIT;
    ELSE
        UPDATE board_count SET
        hit=hit+1
        WHERE name=:NEW.name;
        COMMIT;
    END IF;
END;
/
```


### MemberController.java

- Session, Cookie 활용

### MemberMapper

### BoardVO
- 커맨드 객체 검증

- @NotNull을 붙이면 null값이 들어갔을 때 유효성 검증해줌 
  - import javax.validation.constraints.NotNull;
  
- @Size(min=4,max=8)은 4~8글자 사이로 들어가게 해줌


### BoardController
- public String board_insert_ok(@ModelAttribute("vo") BoardVO vo)
  - @ModelAttribute("vo")는 생략 가능

### application-context.xml
<!-- AOP autoproxy제어 -->
   <aop:aspectj-autoproxy/>
   <!-- 트랜젝션 매니저 -->
   <tx:jta-transaction-manager/>
